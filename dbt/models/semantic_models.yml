version: 2

semantic_models:
  - name: habits
    description: "Semantic model for habit tracking data combining life habits, health habits (sleep), and community engagement habits."
    model: ref('habits')
    entities:
      - name: habit_record
        type: primary
        expr: habit_key
    dimensions:
      - name: habit_date
        type: time
        type_params:
          time_granularity: day
        expr: habit_date
      - name: habit_period
        type: categorical
        expr: habit_period
      - name: habit_name
        type: categorical
        expr: habit
    measures:
      - name: habit_completions
        description: "Count of completed habits"
        agg: sum
        expr: |
          case when is_complete then 1 else 0 end
      - name: total_habits
        description: "Total count of habit records"
        agg: count
        expr: habit_date
      - name: completion_rate
        description: "Percentage of habits completed"
        agg: average
        expr: |
          case when is_complete then 1.0 else 0.0 end

  - name: engagement_contacts
    description: "Semantic model for HubSpot engagements joined with contact and company information. Grain: engagement + contact."
    model: ref('engagement_contacts')
    entities:
      - name: engagement_contact
        type: primary
        expr: engagement_key
      - name: engagement
        type: foreign
        expr: engagement_id
      - name: contact
        type: foreign
        expr: contact_id
      - name: company
        type: foreign
        expr: company_id
    dimensions:
      - name: engagement_date
        type: time
        type_params:
          time_granularity: day
        expr: |
          cast(occurred_at as date)
      - name: engagement_type
        type: categorical
        expr: engagement_type
      - name: is_synchronous
        type: categorical
        expr: |
          case when is_synchronous then 'synchronous' else 'asynchronous' end
      - name: contact_first_name
        type: categorical
        expr: first_name
      - name: contact_last_name
        type: categorical
        expr: last_name
      - name: company_name
        type: categorical
        expr: company_name
    measures:
      - name: engagement_count
        description: "Total count of distinct engagements"
        agg: count_distinct
        expr: engagement_id
      - name: synchronous_engagements
        description: "Count of distinct synchronous engagements (calls, meetings)"
        agg: count_distinct
        expr: |
          case when is_synchronous then engagement_id else null end
      - name: asynchronous_engagements
        description: "Count of distinct asynchronous engagements (emails, etc.)"
        agg: count_distinct
        expr: |
          case when not is_synchronous then engagement_id else null end
      - name: contact_count
        description: "Count of distinct contacts involved in engagements"
        agg: count_distinct
        expr: contact_id

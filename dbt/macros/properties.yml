version: 2

macros:
  - name: json_extract_value
    description: "Cross-database macro to extract scalar values from JSON columns. Uses json_extract_scalar for BigQuery and json_extract_string for DuckDB."
    arguments:
      - name: column_name
        description: "The name of the JSON column to extract from"
        type: string
      - name: json_path
        description: "The JSONPath expression to extract the value (e.g., '$.property_name')"
        type: string
  
  - name: trunc_date
    description: "Adapter-aware macro that truncates timestamps/dates to a specified part (e.g., 'month', 'year'). Pass the part as a quoted literal (for example: 'month'). BigQuery and DuckDB implementations are handled via adapter dispatch."
    arguments:
      - name: part
        description: "The part to truncate to (e.g., 'year', 'month', 'day'). Must be passed as a quoted literal."
        type: string
      - name: column_name
        description: "The timestamp or date column/expression to truncate."
        type: string

  - name: cast_safe
    description: "Adapter-aware macro to safely cast columns to a specified type. Uses SAFE_CAST for BigQuery and TRY_CAST for DuckDB."
    arguments:
      - name: column_name
        description: "The column or expression to cast."
        type: string
      - name: data_type
        description: "The target type to cast to (e.g., 'INT64', 'STRING')."
        type: string

  - name: make_source
    description: "Adapter-aware macro to load the live or mock source based on target name. Returns a ref() if target is 'dev', otherwise returns a source()."
    arguments:
      - name: source
        description: "The source name."
        type: string
      - name: relation
        description: "The relation/table name."
        type: string
      - name: target_name
        description: "The target environment name (e.g. 'dev', 'prod')."
        type: string

  - name: timestamp_parse
    description: "Adapter-aware macro to parse timestamps from columns. Uses timestamp_millis for BigQuery and make_timestamp for DuckDB."
    arguments:
      - name: column_name
        description: "The column containing the timestamp to parse."
        type: string
